{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"C:/Users/t.osato/Documents/subero/suberobeta_app-1/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/t.osato/Documents/subero/suberobeta_app-1/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n//※要追加 :  ・purchasedか何かで受付中のレッスンとそうでないレッスン購入ボタンの表示を変更\n//            ・購入後purchasedの書き換え及びmessageへの移動\nimport React, { useState } from \"react\";\nimport firebase from \"firebase\";\nimport { useRouter } from \"next/router\";\nimport { connect } from \"react-redux\";\nimport Lib from \"../../Lib/address_lib\";\nimport BuyBtn from \"./parts/BuyBtn\";\nimport LessonDitail from \"./parts/LessonDitail\";\nimport Title from \"../normal_parts/Title\";\n\nfunction LessonInfo(props) {\n  // 使用するステートの定義\n  var _useState = useState(\"\"),\n      createrid = _useState[0],\n      setCreaterid = _useState[1];\n\n  var _useState2 = useState(\"\"),\n      lessonid = _useState2[0],\n      setLessonid = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      purchased = _useState3[0],\n      setPurchased = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      lessonname = _useState4[0],\n      setLessonname = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      place = _useState5[0],\n      setPlace = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      time = _useState6[0],\n      setTime = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      price = _useState7[0],\n      setPrice = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      lessoncomment = _useState8[0],\n      setLessoncomment = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      profileusername = _useState9[0],\n      setProfileusername = _useState9[1];\n\n  var _useState10 = useState(\"\"),\n      imageurl = _useState10[0],\n      setImageurl = _useState10[1];\n\n  var db = firebase.firestore();\n  var router = useRouter(); //lessondata及びlessoncreaterのprofileを取得\n\n  var getLessonData = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return db.collection(\"lessons\").doc(router.query.lessonid).get() //データ取得後の処理\n              //取得したデータをlessondataにしまってから、それをステートに突っ込む\n              //lessonidは取得しなくていいかも\n              .then(function (doc) {\n                var lessondata = doc.data();\n                var lesson_id = doc.id;\n                setCreaterid(lessondata.createrid);\n                setLessonid(lesson_id);\n                setPurchased(lessondata.purchased);\n                setLessonname(lessondata.lessonname);\n                setPlace(lessondata.lessonplace);\n                setTime(lessondata.lessontime);\n                setPrice(lessondata.lessonprice);\n                setLessoncomment(lessondata.lessontext);\n                console.log(createrid); //ここからプロフィール取得処理\n                //レッスン情報で取得したcreateridでfirebaseを参照\n\n                db.collection(\"users\").doc(createrid).get() //if文の処理はエラーがあった時のための処理\n                //ネット記事のコピペなので、必要性がどれほどあるかは謎\n                .then(function (doc) {\n                  if (doc.exists) {\n                    var userdata = doc.data();\n                    console.log(createrid, userdata);\n                    setProfileusername(userdata.profile.name);\n                    setImageurl(userdata.imageurl);\n                  } else {\n                    console.log(\"no data\");\n                  }\n                })[\"catch\"](function (error) {\n                  console.log(\"Error getting document:\", error);\n                });\n              });\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getLessonData() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var dobuy = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var email;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              email = Lib.encodeEmail(props.email);\n              _context2.next = 3;\n              return db.collection(\"lessons\").doc(router.query.lessonid).set({\n                buyerid: email\n              }, {\n                merge: true\n              });\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function dobuy() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  if (lessonname == \"\") {\n    getLessonData();\n  }\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    style: {\n      marginTop: \"30px\"\n    },\n    children: [/*#__PURE__*/_jsx(Title, {\n      title: lessonname\n    }), /*#__PURE__*/_jsx(BuyBtn, {\n      lessonid: router.query.lessonid,\n      onClick: dobuy,\n      children: \"\\u8CFC\\u5165\"\n    }), /*#__PURE__*/_jsx(LessonDitail, {\n      imageurl: imageurl,\n      profileusername: profileusername,\n      price: price,\n      place: place,\n      time: time,\n      lessoncomment: lessoncomment\n    })]\n  });\n}\n\nLessonInfo = connect(function (state) {\n  return state;\n})(LessonInfo);\nexport default LessonInfo;","map":null,"metadata":{},"sourceType":"module"}