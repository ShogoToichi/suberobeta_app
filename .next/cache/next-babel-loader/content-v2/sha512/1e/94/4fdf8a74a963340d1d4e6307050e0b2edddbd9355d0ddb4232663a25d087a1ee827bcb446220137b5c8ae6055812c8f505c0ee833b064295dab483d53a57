{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\programing_practice\\\\suberobeta_app\\\\components\\\\Message.js\";\nimport React, { useState } from \"react\";\nimport firebase from \"firebase\";\nimport { useRouter } from \"next/router\";\nimport Lib from \"../static/address_lib\";\nimport { connect } from \"react-redux\";\nimport \"firebase/storage\";\n\nfunction Message(props) {\n  //ステート定義\n  const {\n    0: createrid,\n    1: setCreaterid\n  } = useState(\"\");\n  const {\n    0: messages,\n    1: setMessages\n  } = useState(\"\");\n  const {\n    0: buyerid,\n    1: setBuyerid\n  } = useState(\"\");\n  const {\n    0: lessonname,\n    1: setLessonname\n  } = useState(\"\"); //送信者によってスタイルを変更するテスト用のスタイル\n\n  const style2 = {\n    backgroundColor: \"blue\"\n  };\n  const style1 = {\n    backgroundColor: \"\"\n  };\n  const messagedata = [];\n  const messageitems = [];\n  const router = useRouter(); //lessondata及びmessageを取得\n\n  const getMessageData = async () => {\n    const email = Lib.encodeEmail(props.email);\n    const db = firebase.firestore(); //router.query.lessonidでページのurlの末尾を取得\n    //先にレッスン名と作成者、購入者のidを取得\n\n    await db.collection(\"lessons\").doc(router.query.lessonid).get() //取得したデータをlessondataにしまってから、それをステートに突っ込む\n    .then(function (doc) {\n      const lessondata = doc.data();\n      setCreaterid(lessondata.createrid);\n      setLessonname(lessondata.lessonname);\n      setBuyerid(lessondata.buyerid); //メッセージ情報取得処理\n      //orderBy(time)で時間の古い順に並べる\n\n      db.collection(\"lessons\").doc(router.query.lessonid).collection(\"message\").orderBy(\"time\").get() //取得したデータをmessagedata配列に入れる。\n      //配列の繰り返し処理でメッセージのjsxを作り、\n      //messageitemsに入れて、最後にstateに入れる\n      .then(function (querySnapshot) {\n        querySnapshot.forEach(function (doc) {\n          messagedata.push(doc.data());\n        });\n\n        for (let i in messagedata) {\n          let text = messagedata[i].text;\n          let userid = messagedata[i].userid; //送信者とReduxメアドの比較でスタイル分岐\n\n          if (userid == email) {\n            messageitems.push( /*#__PURE__*/_jsxDEV(\"p\", {\n              style: style1,\n              children: text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 57,\n              columnNumber: 21\n            }, this));\n          } else {\n            messageitems.push( /*#__PURE__*/_jsxDEV(\"p\", {\n              style: style2,\n              children: text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 61,\n              columnNumber: 21\n            }, this));\n          }\n        } //作成者、購入者以外メッセージが見れないようにする\n\n\n        if (email == createrid || email == buyerid) {\n          setMessages(messageitems);\n        } else {\n          const errorMessage = /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"\\u3054\\u5229\\u7528\\u3044\\u305F\\u3060\\u3051\\u307E\\u305B\\u3093\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 36\n          }, this);\n\n          setMessages(errorMessage);\n        }\n      });\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: getMessageData,\n      children: \"\\u8AAD\\u307F\\u8FBC\\u307F\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: lessonname\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 5\n    }, this), messages]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 3\n  }, this);\n}\n\nMessage = connect(state => state)(Message);\nexport default Message;","map":{"version":3,"sources":["C:/Users/programing_practice/suberobeta_app/components/Message.js"],"names":["React","useState","firebase","useRouter","Lib","connect","Message","props","createrid","setCreaterid","messages","setMessages","buyerid","setBuyerid","lessonname","setLessonname","style2","backgroundColor","style1","messagedata","messageitems","router","getMessageData","email","encodeEmail","db","firestore","collection","doc","query","lessonid","get","then","lessondata","data","orderBy","querySnapshot","forEach","push","i","text","userid","errorMessage","state"],"mappings":"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","sourcesContent":["import React,{useState} from \"react\";\r\nimport firebase from \"firebase\";\r\nimport {useRouter}from \"next/router\";\r\nimport Lib from \"../static/address_lib\"\r\nimport { connect } from \"react-redux\";\r\nimport \"firebase/storage\";\r\n\r\nfunction Message (props){\r\n  //ステート定義\r\n  const [createrid,setCreaterid]= useState(\"\");\r\n  const [messages,setMessages] = useState(\"\");\r\n  const [buyerid,setBuyerid]= useState(\"\");\r\n  const [lessonname,setLessonname] = useState(\"\");\r\n  \r\n  //送信者によってスタイルを変更するテスト用のスタイル\r\n  const style2 = {\r\n    backgroundColor :\"blue\",\r\n  }\r\n  const style1 = {\r\n    backgroundColor :\"\",\r\n  }\r\n  const messagedata=[];\r\n  const messageitems=[];\r\n\r\n  const router = useRouter();\r\n  //lessondata及びmessageを取得\r\n  const getMessageData= async()=>{\r\n    const email = Lib.encodeEmail(props.email);\r\n    const db = firebase.firestore ();\r\n    //router.query.lessonidでページのurlの末尾を取得\r\n    //先にレッスン名と作成者、購入者のidを取得\r\n    await db.collection(\"lessons\").doc(router.query.lessonid).get()\r\n    //取得したデータをlessondataにしまってから、それをステートに突っ込む\r\n    .then(function(doc){\r\n      const lessondata = doc.data();\r\n        setCreaterid(lessondata.createrid);\r\n        setLessonname(lessondata.lessonname);\r\n        setBuyerid(lessondata.buyerid);\r\n\r\n        //メッセージ情報取得処理\r\n        //orderBy(time)で時間の古い順に並べる\r\n        db.collection(\"lessons\").doc(router.query.lessonid).collection(\"message\").orderBy(\"time\")\r\n        .get()\r\n        //取得したデータをmessagedata配列に入れる。\r\n        //配列の繰り返し処理でメッセージのjsxを作り、\r\n        //messageitemsに入れて、最後にstateに入れる\r\n          .then(function(querySnapshot){\r\n              querySnapshot.forEach(function(doc){\r\n                messagedata.push(doc.data());\r\n              });\r\n            for(let i in messagedata){\r\n              let text = messagedata[i].text;\r\n              let userid = messagedata[i].userid;\r\n              //送信者とReduxメアドの比較でスタイル分岐\r\n              if(userid == email){\r\n                messageitems.push(\r\n                    <p style={style1}>{text}</p>\r\n                );}\r\n              else {\r\n                messageitems.push(\r\n                    <p style={style2}>{text}</p>\r\n                );\r\n              }\r\n            }\r\n            //作成者、購入者以外メッセージが見れないようにする\r\n            if (email==createrid || email==buyerid){\r\n                setMessages(messageitems);\r\n              }\r\n              else{\r\n                const errorMessage=<p>ご利用いただけません</p>\r\n                setMessages(errorMessage);\r\n              }\r\n          })\r\n  })}\r\n  \r\nreturn(\r\n  <div>\r\n    <button onClick={getMessageData}>読み込み</button>\r\n    <h2>{lessonname}</h2>\r\n    {messages}\r\n  </div>\r\n)\r\n}\r\n\r\n\r\nMessage = connect((state)=>state)(Message);\r\nexport default Message;"]},"metadata":{},"sourceType":"module"}