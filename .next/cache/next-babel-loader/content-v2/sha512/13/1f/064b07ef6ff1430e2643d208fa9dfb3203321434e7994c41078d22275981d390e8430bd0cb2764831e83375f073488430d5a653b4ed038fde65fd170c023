{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/programing_practice/suberobeta_app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _asyncToGenerator from \"C:/Users/programing_practice/suberobeta_app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\programing_practice\\\\suberobeta_app\\\\components\\\\Message.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport firebase from \"firebase\";\nimport { useRouter } from \"next/router\";\nimport Lib from \"../static/address_lib\";\nimport { connect } from \"react-redux\";\nimport \"firebase/storage\";\n\nfunction Message(props) {\n  _s();\n\n  //ステート定義\n  var _useState = useState(\"\"),\n      createrid = _useState[0],\n      setCreaterid = _useState[1];\n\n  var _useState2 = useState(\"\"),\n      messages = _useState2[0],\n      setMessages = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      buyerid = _useState3[0],\n      setBuyerid = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      lessonname = _useState4[0],\n      setLessonname = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      creatername = _useState5[0],\n      setCreaterName = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      buyername = _useState6[0],\n      setBuyerName = _useState6[1]; //送信者によってスタイルを変更するテスト用のスタイル\n\n\n  var style = {\n    // border:\"solid 1px #DDD\", \n    backgroundColor: \"#E0E0E0\",\n    borderRadius: \"7px\",\n    height: \"40px\",\n    verticalAlign: \"middle\",\n    padding: \"10px 20px 0px 20px\",\n    fontSize: \"20px\",\n    display: \"inline-block\",\n    marginBottom: \"10px\"\n  };\n  var messagedata = [];\n  var messageitems = [];\n  var router = useRouter();\n  var email = Lib.encodeEmail(props.email);\n  var db = firebase.firestore(); //lessondata及びmessageを取得\n\n  var getMessageData = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return db.collection(\"lessons\").doc(router.query.lessonid).get() //取得したデータをlessondataにしまってから、それをステートに突っ込む\n              .then(function (doc) {\n                var lessondata = doc.data();\n                setCreaterid(lessondata.createrid);\n                setLessonname(lessondata.lessonname);\n                setBuyerid(lessondata.buyerid);\n              });\n\n            case 2:\n              _context.next = 4;\n              return db.collection(\"users\").doc(createrid).get().then(function (doc) {\n                var createrdata = doc.data();\n                setCreaterName(createrdata.profile.name);\n              });\n\n            case 4:\n              _context.next = 6;\n              return db.collection(\"lessons\").doc(router.query.lessonid).collection(\"message\").orderBy(\"time\").get() //取得したデータをmessagedata配列に入れる。\n              //配列の繰り返し処理でメッセージのjsxを作り、\n              //messageitemsに入れて、最後にstateに入れる\n              .then(function (querySnapshot) {\n                querySnapshot.forEach(function (doc) {\n                  messagedata.push(doc.data());\n                });\n\n                for (var i in messagedata) {\n                  var text = messagedata[i].text;\n                  var userid = messagedata[i].userid; //送信者とReduxメアドの比較でスタイル分岐\n\n                  if (userid == email) {\n                    messageitems.push( /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                        style: {\n                          marginBottom: \"3\"\n                        },\n                        children: creatername\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 71,\n                        columnNumber: 21\n                      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                        style: style,\n                        children: text\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 72,\n                        columnNumber: 21\n                      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 73,\n                        columnNumber: 21\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 70,\n                      columnNumber: 19\n                    }, this));\n                  } else {\n                    messageitems.push( /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        style: style,\n                        children: text\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 80,\n                        columnNumber: 21\n                      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 81,\n                        columnNumber: 21\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 78,\n                      columnNumber: 19\n                    }, this));\n                  }\n                } //作成者、購入者以外メッセージが見れないようにする\n\n\n                if (email == createrid || email == buyerid) {\n                  setMessages(messageitems);\n                } else {\n                  var errorMessage = /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: \"\\u3054\\u5229\\u7528\\u3044\\u305F\\u3060\\u3051\\u307E\\u305B\\u3093\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 91,\n                    columnNumber: 36\n                  }, this);\n\n                  setMessages(errorMessage);\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getMessageData() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: getMessageData,\n      children: \"\\u8AAD\\u307F\\u8FBC\\u307F\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 5\n    }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: lessonname\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 5\n    }, this), messages]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 3\n  }, this);\n}\n\n_s(Message, \"34tLb3R16b2O1iBrYe/OkkkyyC8=\", false, function () {\n  return [useRouter];\n});\n\n_c = Message;\nMessage = connect(function (state) {\n  return state;\n})(Message);\nexport default Message;\n\nvar _c;\n\n$RefreshReg$(_c, \"Message\");","map":{"version":3,"sources":["C:/Users/programing_practice/suberobeta_app/components/Message.js"],"names":["React","useState","firebase","useRouter","Lib","connect","Message","props","createrid","setCreaterid","messages","setMessages","buyerid","setBuyerid","lessonname","setLessonname","creatername","setCreaterName","buyername","setBuyerName","style","backgroundColor","borderRadius","height","verticalAlign","padding","fontSize","display","marginBottom","messagedata","messageitems","router","email","encodeEmail","db","firestore","getMessageData","collection","doc","query","lessonid","get","then","lessondata","data","createrdata","profile","name","orderBy","querySnapshot","forEach","push","i","text","userid","errorMessage","state"],"mappings":"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","sourcesContent":["import React,{useState} from \"react\";\r\nimport firebase from \"firebase\";\r\nimport {useRouter}from \"next/router\";\r\nimport Lib from \"../static/address_lib\"\r\nimport { connect } from \"react-redux\";\r\nimport \"firebase/storage\";\r\n\r\nfunction Message (props){\r\n  //ステート定義\r\n  const [createrid,setCreaterid]= useState(\"\");\r\n  const [messages,setMessages] = useState(\"\");\r\n  const [buyerid,setBuyerid]= useState(\"\");\r\n  const [lessonname,setLessonname] = useState(\"\");\r\n  const [creatername,setCreaterName] = useState(\"\");\r\n  const [buyername, setBuyerName] = useState(\"\");\r\n  \r\n  //送信者によってスタイルを変更するテスト用のスタイル\r\n  const style = {\r\n    // border:\"solid 1px #DDD\", \r\n    backgroundColor :\"#E0E0E0\",\r\n    borderRadius: \"7px\",\r\n    height:\"40px\",\r\n    verticalAlign:\"middle\",\r\n    padding:\"10px 20px 0px 20px\",\r\n    fontSize:\"20px\",\r\n    display:\"inline-block\",\r\n    marginBottom:\"10px\",\r\n  }\r\n  const messagedata=[];\r\n  const messageitems=[];\r\n  \r\n  const router = useRouter();\r\n  const email = Lib.encodeEmail(props.email);\r\n  const db = firebase.firestore ();\r\n\r\n  //lessondata及びmessageを取得\r\n  const getMessageData= async()=>{\r\n    //router.query.lessonidでページのurlの末尾を取得\r\n    //先にレッスン名と作成者、購入者のidを取得\r\n    await db.collection(\"lessons\").doc(router.query.lessonid).get()\r\n    //取得したデータをlessondataにしまってから、それをステートに突っ込む\r\n    .then(function(doc){\r\n      const lessondata = doc.data();\r\n        setCreaterid(lessondata.createrid);\r\n        setLessonname(lessondata.lessonname);\r\n        setBuyerid(lessondata.buyerid);\r\n      })\r\n    await db.collection(\"users\").doc(createrid).get()\r\n      .then(function(doc){\r\n        const createrdata = doc.data();\r\n        setCreaterName(createrdata.profile.name);\r\n      })\r\n        //メッセージ情報取得処理\r\n        //orderBy(time)で時間の古い順に並べる\r\n    await db.collection(\"lessons\").doc(router.query.lessonid).collection(\"message\").orderBy(\"time\")\r\n        .get()\r\n        //取得したデータをmessagedata配列に入れる。\r\n        //配列の繰り返し処理でメッセージのjsxを作り、\r\n        //messageitemsに入れて、最後にstateに入れる\r\n          .then(function(querySnapshot){\r\n              querySnapshot.forEach(function(doc){\r\n                messagedata.push(doc.data());\r\n              });\r\n            for(let i in messagedata){\r\n              let text = messagedata[i].text;\r\n              let userid = messagedata[i].userid;\r\n              //送信者とReduxメアドの比較でスタイル分岐\r\n              if(userid == email){\r\n                messageitems.push(\r\n                  <div>\r\n                    <p style={{marginBottom:\"3\"}}>{creatername}</p>\r\n                    <div style={style}>{text}</div>\r\n                    <br/>\r\n                  </div>\r\n                );}\r\n              else {\r\n                messageitems.push(\r\n                  <div>\r\n\r\n                    <div style={style}>{text}</div>\r\n                    <br/>\r\n                  </div>\r\n                );\r\n              }\r\n            }\r\n            //作成者、購入者以外メッセージが見れないようにする\r\n            if (email==createrid || email==buyerid){\r\n                setMessages(messageitems);\r\n              }\r\n              else{\r\n                const errorMessage=<p>ご利用いただけません</p>\r\n                setMessages(errorMessage);\r\n              }\r\n          })\r\n  }\r\n  \r\nreturn(\r\n  <div>\r\n    <button onClick={getMessageData}>読み込み</button>\r\n    <h2>{lessonname}</h2>\r\n    {messages}\r\n  </div>\r\n)\r\n}\r\n\r\n\r\nMessage = connect((state)=>state)(Message);\r\nexport default Message;"]},"metadata":{},"sourceType":"module"}